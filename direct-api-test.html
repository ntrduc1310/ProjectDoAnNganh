<!DOCTYPE html>
<html>
<head>
    <title>Direct API Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .test-button { background: #007bff; color: white; border: none; border-radius: 3px; }
        .test-button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîß Direct Backend API Testing</h1>
    <p>Testing backend connection from localhost:5173 to localhost:8081</p>

    <div>
        <button class="test-button" onclick="testTasksAPI()">Test /api/tasks</button>
        <button class="test-button" onclick="testStatsAPI()">Test /api/dashboard/stats</button>
        <button class="test-button" onclick="testCreateTask()">Test Create Task</button>
        <button class="test-button" onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <script>
        function addResult(title, content, isSuccess = true) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testTasksAPI() {
            try {
                console.log('üß™ Testing Tasks API...');
                
                const response = await fetch('http://localhost:8081/api/tasks', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                console.log('üì° Response status:', response.status);
                console.log('üì° Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Tasks data:', data);
                
                addResult(
                    '‚úÖ GET /api/tasks - SUCCESS', 
                    `Status: ${response.status}\\nData: ${JSON.stringify(data, null, 2)}`,
                    true
                );
            } catch (error) {
                console.error('‚ùå Tasks API failed:', error);
                addResult(
                    '‚ùå GET /api/tasks - FAILED', 
                    `Error: ${error.message}`,
                    false
                );
            }
        }

        async function testStatsAPI() {
            try {
                console.log('üß™ Testing Stats API...');
                
                const response = await fetch('http://localhost:8081/api/dashboard/stats', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                console.log('üì° Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Stats data:', data);
                
                addResult(
                    '‚úÖ GET /api/dashboard/stats - SUCCESS', 
                    `Status: ${response.status}\\nData: ${JSON.stringify(data, null, 2)}`,
                    true
                );
            } catch (error) {
                console.error('‚ùå Stats API failed:', error);
                addResult(
                    '‚ùå GET /api/dashboard/stats - FAILED', 
                    `Error: ${error.message}`,
                    false
                );
            }
        }

        async function testCreateTask() {
            try {
                console.log('üß™ Testing Create Task API...');
                
                const taskData = {
                    title: 'Test Task from Direct API',
                    description: 'This is a test task created directly via fetch API',
                    priority: 'MEDIUM',
                    status: 'TODO',
                    assigneeId: 1,
                    projectId: 1
                };

                const response = await fetch('http://localhost:8081/api/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(taskData)
                });

                console.log('üì° Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Created task:', data);
                
                addResult(
                    '‚úÖ POST /api/tasks - SUCCESS', 
                    `Status: ${response.status}\\nCreated Task: ${JSON.stringify(data, null, 2)}`,
                    true
                );
            } catch (error) {
                console.error('‚ùå Create Task API failed:', error);
                addResult(
                    '‚ùå POST /api/tasks - FAILED', 
                    `Error: ${error.message}`,
                    false
                );
            }
        }

        // Auto-run tests when page loads
        window.onload = function() {
            console.log('üöÄ Starting automatic API tests...');
            setTimeout(testStatsAPI, 1000);
            setTimeout(testTasksAPI, 2000);
        };
    </script>
</body>
</html>
